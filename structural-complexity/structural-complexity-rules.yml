# SQL Complexity Rules
# SQL 자체의 구조적 복잡도를 측정하기 위한 룰 정의
# 
# 입력 파라미터:
#   - query_list: SQL 쿼리 목록 파일
#   - source_db: Source DBMS (ORA, MY, MDB, PG, SS, ALT, DB2)

metadata:
  version: "1.0.0"
  description: "SQL 구조적 복잡도 분석 룰"
  supported_db: ["ORA", "MY", "MDB", "PG", "SS", "ALT", "DB2"]

# 점수 계산 설정
scoring:
  categories:
    structural:
      weight_percent: 30
      max_score: 100
    clause:
      weight_percent: 15
      max_score: 50
    function_expression:
      weight_percent: 20
      max_score: 80
    query_metric:
      weight_percent: 10
      max_score: 40
    dbms_specific:
      weight_percent: 25
      max_score: 100
  
  complexity_levels:
    - level: "매우 단순"
      min_score: 0
      max_score: 2
      description: "단순 CRUD"
    - level: "단순"
      min_score: 2
      max_score: 4
      description: "기본 JOIN/조건"
    - level: "보통"
      min_score: 4
      max_score: 6
      description: "복합 JOIN, 서브쿼리"
    - level: "복잡"
      min_score: 6
      max_score: 8
      description: "다중 서브쿼리, 윈도우 함수"
    - level: "매우 복잡"
      min_score: 8
      max_score: 10
      description: "계층 쿼리, 동적 SQL"


# ============================================================
# Part 1: 공통 항목 (Common Rules)
# 모든 DBMS에 공통으로 적용
# ============================================================

common_rules:

  # ----------------------------------------------------------
  # 1.1 구조적 복잡성 - JOIN
  # ----------------------------------------------------------
  structural_join:
    - id: c_join_0
      name: "JOIN 없음"
      weight: 0
      detection_method: regex
      logic: "join_count == 0"
      
    - id: c_join_1
      name: "JOIN 1개"
      weight: 5
      detection_method: regex
      logic: "join_count == 1"
      
    - id: c_join_2_3
      name: "JOIN 2-3개"
      weight: 10
      detection_method: regex
      logic: "2 <= join_count <= 3"
      
    - id: c_join_4_5
      name: "JOIN 4-5개"
      weight: 15
      detection_method: regex
      logic: "4 <= join_count <= 5"
      
    - id: c_join_6plus
      name: "JOIN 6개 이상"
      weight: 20
      detection_method: regex
      logic: "join_count >= 6"

  # ----------------------------------------------------------
  # 1.2 구조적 복잡성 - 서브쿼리
  # 순차 스캔 방식으로 (SELECT 패턴을 추적하여 깊이 계산
  # ----------------------------------------------------------
  structural_subquery:
    - id: c_subq_0
      name: "서브쿼리 없음"
      weight: 0
      detection_method: regex
      logic: "subquery_depth == 0"
      
    - id: c_subq_depth_1
      name: "서브쿼리 깊이 1"
      weight: 10
      detection_method: regex
      logic: "subquery_depth == 1"
      
    - id: c_subq_depth_2
      name: "서브쿼리 깊이 2"
      weight: 20
      detection_method: regex
      logic: "subquery_depth == 2"
      
    - id: c_subq_depth_3plus
      name: "서브쿼리 깊이 3+"
      weight: 30
      detection_method: regex
      logic: "subquery_depth >= 3"
      
    - id: c_subq_count
      name: "서브쿼리 개수"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      logic: "subquery_count * 5"
      
    - id: c_subq_correlated
      name: "상관 서브쿼리"
      weight: 15
      detection_method: regex
      logic: "has_correlated_subquery"

  # ----------------------------------------------------------
  # 1.3 구조적 복잡성 - CTE
  # ----------------------------------------------------------
  structural_cte:
    - id: c_cte_1
      name: "CTE 1개"
      weight: 10
      detection_method: regex
      pattern: "WITH\\s+\\w+\\s+AS\\s*\\("
      logic: "cte_count == 1"
      
    - id: c_cte_2_3
      name: "CTE 2-3개"
      weight: 15
      detection_method: regex
      pattern: "WITH\\s+\\w+\\s+AS\\s*\\("
      logic: "2 <= cte_count <= 3"
      
    - id: c_cte_4plus
      name: "CTE 4개 이상"
      weight: 20
      detection_method: regex
      pattern: "WITH\\s+\\w+\\s+AS\\s*\\("
      logic: "cte_count >= 4"

  # ----------------------------------------------------------
  # 1.4 구조적 복잡성 - 집합 연산
  # ----------------------------------------------------------
  structural_set_operations:
    - id: c_union
      name: "UNION"
      weight: 10
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bUNION\\b(?!\\s+ALL)"
      
    - id: c_union_all
      name: "UNION ALL"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bUNION\\s+ALL\\b"
      
    - id: c_intersect
      name: "INTERSECT"
      weight: 10
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bINTERSECT\\b"


  # ----------------------------------------------------------
  # 1.5 절 복잡성 - SELECT
  # ----------------------------------------------------------
  clause_select:
    - id: c_select_cols_1_5
      name: "컬럼 1-5개"
      weight: 0
      detection_method: regex
      logic: "1 <= select_column_count <= 5"
      
    - id: c_select_cols_6_10
      name: "컬럼 6-10개"
      weight: 5
      detection_method: regex
      logic: "6 <= select_column_count <= 10"
      
    - id: c_select_cols_11_20
      name: "컬럼 11-20개"
      weight: 10
      detection_method: regex
      logic: "11 <= select_column_count <= 20"
      
    - id: c_select_cols_21plus
      name: "컬럼 21개 이상"
      weight: 15
      detection_method: regex
      logic: "select_column_count >= 21"
      
    - id: c_select_star
      name: "SELECT *"
      weight: 5
      detection_method: regex
      pattern: "SELECT\\s+\\*"
      
    - id: c_distinct
      name: "DISTINCT"
      weight: 5
      detection_method: regex
      pattern: "SELECT\\s+(ALL\\s+)?DISTINCT"

  # ----------------------------------------------------------
  # 1.6 절 복잡성 - WHERE
  # 조건의 복잡도는 조건 수(AND/OR)로 측정
  # 서브쿼리 내 AND/OR는 제외하고 외부 조건만 카운트
  # 개별 비교 연산자(=, >=, <=, BETWEEN, LIKE, IN 등)는 
  # 구조적 복잡도에 영향을 주지 않으므로 별도 카운팅하지 않음
  # ----------------------------------------------------------
  clause_where:
    - id: c_where_cond_1_3
      name: "조건 1-3개"
      weight: 0
      detection_method: regex
      logic: "1 <= where_condition_count <= 3"
      
    - id: c_where_cond_4_6
      name: "조건 4-6개"
      weight: 5
      detection_method: regex
      logic: "4 <= where_condition_count <= 6"
      
    - id: c_where_cond_7_10
      name: "조건 7-10개"
      weight: 10
      detection_method: regex
      logic: "7 <= where_condition_count <= 10"
      
    - id: c_where_cond_11plus
      name: "조건 11개 이상"
      weight: 15
      detection_method: regex
      logic: "where_condition_count >= 11"

  # ----------------------------------------------------------
  # 1.7 절 복잡성 - GROUP BY / HAVING / ORDER BY
  # ----------------------------------------------------------
  clause_grouping:
    - id: c_group_by
      name: "GROUP BY 사용"
      weight: 5
      detection_method: regex
      pattern: "\\bGROUP\\s+BY\\b"
      
    - id: c_having
      name: "HAVING 사용"
      weight: 10
      detection_method: regex
      pattern: "\\bHAVING\\b"
      
    - id: c_order_by
      name: "ORDER BY 사용"
      weight: 3
      detection_method: regex
      pattern: "\\bORDER\\s+BY\\b"


  # ----------------------------------------------------------
  # 1.8 함수/표현식 - 집계 함수
  # ----------------------------------------------------------
  function_aggregate:
    - id: c_agg_count
      name: "COUNT()"
      weight: 3
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bCOUNT\\s*\\("
      
    - id: c_agg_sum
      name: "SUM()"
      weight: 3
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bSUM\\s*\\("
      
    - id: c_agg_avg
      name: "AVG()"
      weight: 3
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bAVG\\s*\\("
      
    - id: c_agg_min_max
      name: "MIN()/MAX()"
      weight: 3
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\b(MIN|MAX)\\s*\\("
      
    - id: c_agg_distinct
      name: "집계 내 DISTINCT"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "(COUNT|SUM|AVG)\\s*\\(\\s*DISTINCT"

  # ----------------------------------------------------------
  # 1.9 함수/표현식 - 윈도우 함수
  # ----------------------------------------------------------
  function_window:
    - id: c_window_over
      name: "OVER 절"
      weight: 10
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bOVER\\s*\\("
      
    - id: c_window_partition
      name: "PARTITION BY"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bPARTITION\\s+BY\\b"
      
    - id: c_window_frame
      name: "ROWS/RANGE BETWEEN"
      weight: 10
      weight_per_occurrence: true
      detection_method: regex
      pattern: "(ROWS|RANGE)\\s+BETWEEN"

  # ----------------------------------------------------------
  # 1.10 함수/표현식 - CASE
  # ----------------------------------------------------------
  function_case:
    - id: c_case
      name: "CASE 표현식"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bCASE\\b"
      
    - id: c_case_when
      name: "WHEN 절"
      weight: 2
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bWHEN\\b"
      
    - id: c_case_nested
      name: "중첩 CASE"
      weight: 15
      detection_method: regex
      logic: "case_max_depth >= 2"

  # ----------------------------------------------------------
  # 1.11 함수/표현식 - 공통 함수
  # ----------------------------------------------------------
  function_common:
    - id: c_func_string
      name: "문자열 함수"
      weight: 2
      weight_per_occurrence: true
      detection_method: regex
      pattern: "(SUBSTR|SUBSTRING|CONCAT|REPLACE|TRIM|UPPER|LOWER)\\s*\\("
      
    - id: c_func_math
      name: "수학 함수"
      weight: 2
      weight_per_occurrence: true
      detection_method: regex
      pattern: "(ROUND|FLOOR|CEIL|ABS|MOD)\\s*\\("
      
    - id: c_func_null
      name: "NULL 처리 함수"
      weight: 2
      weight_per_occurrence: true
      detection_method: regex
      pattern: "(COALESCE|NULLIF)\\s*\\("
      
    - id: c_func_cast
      name: "CAST 함수"
      weight: 3
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bCAST\\s*\\("

  # ----------------------------------------------------------
  # 1.12 쿼리 메트릭
  # ----------------------------------------------------------
  query_metrics:
    - id: c_len_short
      name: "짧은 쿼리 (< 200자)"
      weight: 0
      detection_method: metric
      logic: "len(sql) < 200"
      
    - id: c_len_medium
      name: "중간 쿼리 (200-500자)"
      weight: 5
      detection_method: metric
      logic: "200 <= len(sql) < 500"
      
    - id: c_len_long
      name: "긴 쿼리 (500-1000자)"
      weight: 10
      detection_method: metric
      logic: "500 <= len(sql) < 1000"
      
    - id: c_len_very_long
      name: "매우 긴 쿼리 (1000-2000자)"
      weight: 15
      detection_method: metric
      logic: "1000 <= len(sql) < 2000"
      
    - id: c_len_huge
      name: "초대형 쿼리 (2000자+)"
      weight: 20
      detection_method: metric
      logic: "len(sql) >= 2000"
      
    - id: c_tables_3_5
      name: "테이블 3-5개"
      weight: 5
      detection_method: regex
      logic: "3 <= table_count <= 5"
      
    - id: c_tables_6_10
      name: "테이블 6-10개"
      weight: 10
      detection_method: regex
      logic: "6 <= table_count <= 10"
      
    - id: c_tables_11plus
      name: "테이블 11개 이상"
      weight: 15
      detection_method: regex
      logic: "table_count >= 11"


# ============================================================
# Part 2: DBMS별 항목 (DBMS-Specific Rules)
# source_db에 따라 선택적으로 적용
# ============================================================

dbms_specific_rules:

  # ----------------------------------------------------------
  # 2.1 Oracle (ORA)
  # ----------------------------------------------------------
  ORA:
    - id: ora_plus_join
      name: "(+) 조인 문법"
      weight: 10
      detection_method: regex
      pattern: "\\w+\\s*\\(\\+\\)"
      
    - id: ora_connect_by
      name: "CONNECT BY"
      weight: 25
      detection_method: regex
      pattern: "\\bCONNECT\\s+BY\\b"
      
    - id: ora_start_with
      name: "START WITH"
      weight: 20
      detection_method: regex
      pattern: "\\bSTART\\s+WITH\\b"
      
    - id: ora_prior
      name: "PRIOR"
      weight: 15
      detection_method: regex
      pattern: "\\bPRIOR\\s+\\w+"
      
    - id: ora_sys_connect_path
      name: "SYS_CONNECT_BY_PATH"
      weight: 20
      detection_method: regex
      pattern: "SYS_CONNECT_BY_PATH\\s*\\("
      
    - id: ora_connect_by_root
      name: "CONNECT_BY_ROOT"
      weight: 20
      detection_method: regex
      pattern: "CONNECT_BY_ROOT\\s+\\w+"
      
    - id: ora_level
      name: "LEVEL (계층)"
      weight: 10
      detection_method: regex
      pattern: "\\bLEVEL\\b"
      
    - id: ora_rownum
      name: "ROWNUM"
      weight: 15
      detection_method: regex
      pattern: "\\bROWNUM\\b"
      
    - id: ora_rowid
      name: "ROWID"
      weight: 15
      detection_method: regex
      pattern: "\\bROWID\\b"
      
    - id: ora_decode
      name: "DECODE()"
      weight: 10
      detection_method: regex
      pattern: "\\bDECODE\\s*\\("
      
    - id: ora_nvl
      name: "NVL()"
      weight: 3
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bNVL\\s*\\("
      
    - id: ora_nvl2
      name: "NVL2()"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bNVL2\\s*\\("
      
    - id: ora_to_char
      name: "TO_CHAR()"
      weight: 3
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bTO_CHAR\\s*\\("
      
    - id: ora_to_date
      name: "TO_DATE()"
      weight: 3
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bTO_DATE\\s*\\("
      
    - id: ora_to_number
      name: "TO_NUMBER()"
      weight: 3
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bTO_NUMBER\\s*\\("
      
    - id: ora_sysdate
      name: "SYSDATE"
      weight: 2
      detection_method: regex
      pattern: "\\bSYSDATE\\b"
      
    - id: ora_dual
      name: "DUAL 테이블"
      weight: 2
      detection_method: regex
      pattern: "\\bFROM\\s+DUAL\\b"
      
    - id: ora_listagg
      name: "LISTAGG()"
      weight: 10
      detection_method: regex
      pattern: "\\bLISTAGG\\s*\\("
      
    - id: ora_pivot
      name: "PIVOT"
      weight: 20
      detection_method: regex
      pattern: "\\bPIVOT\\s*\\("
      
    - id: ora_unpivot
      name: "UNPIVOT"
      weight: 20
      detection_method: regex
      pattern: "\\bUNPIVOT\\s*\\("
      
    - id: ora_model
      name: "MODEL 절"
      weight: 25
      detection_method: regex
      pattern: "\\bMODEL\\s+(RETURN|DIMENSION|MEASURES)"
      
    - id: ora_hint
      name: "Oracle 힌트"
      weight: 10
      detection_method: regex
      pattern: "/\\*\\+.*\\*/"
      
    - id: ora_merge
      name: "MERGE INTO"
      weight: 15
      detection_method: regex
      pattern: "\\bMERGE\\s+INTO\\b"
      
    - id: ora_returning
      name: "RETURNING INTO"
      weight: 10
      detection_method: regex
      pattern: "\\bRETURNING\\b.*\\bINTO\\b"
      
    - id: ora_bulk_collect
      name: "BULK COLLECT"
      weight: 15
      detection_method: regex
      pattern: "\\bBULK\\s+COLLECT\\b"
      
    - id: ora_forall
      name: "FORALL"
      weight: 15
      detection_method: regex
      pattern: "\\bFORALL\\b"
      
    - id: ora_execute_immediate
      name: "EXECUTE IMMEDIATE"
      weight: 20
      detection_method: regex
      pattern: "\\bEXECUTE\\s+IMMEDIATE\\b"
      
    - id: ora_ref_cursor
      name: "REF CURSOR"
      weight: 20
      detection_method: regex
      pattern: "\\bREF\\s+CURSOR\\b|SYS_REFCURSOR"
      
    - id: ora_exception
      name: "EXCEPTION WHEN"
      weight: 15
      detection_method: regex
      pattern: "\\bEXCEPTION\\s+WHEN\\b"
      
    - id: ora_minus
      name: "MINUS"
      weight: 10
      detection_method: regex
      pattern: "\\bMINUS\\b"


  # ----------------------------------------------------------
  # 2.2 MySQL / MariaDB (MY, MDB)
  # ----------------------------------------------------------
  MY: &mysql_rules
    - id: my_limit
      name: "LIMIT"
      weight: 5
      detection_method: regex
      pattern: "\\bLIMIT\\s+\\d+"
      
    - id: my_limit_offset
      name: "LIMIT OFFSET"
      weight: 5
      detection_method: regex
      pattern: "\\bLIMIT\\s+\\d+\\s+OFFSET\\s+\\d+"
      
    - id: my_ifnull
      name: "IFNULL()"
      weight: 3
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bIFNULL\\s*\\("
      
    - id: my_if_func
      name: "IF() 함수"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bIF\\s*\\(\\s*\\w+"
      
    - id: my_group_concat
      name: "GROUP_CONCAT()"
      weight: 10
      detection_method: regex
      pattern: "\\bGROUP_CONCAT\\s*\\("
      
    - id: my_date_format
      name: "DATE_FORMAT()"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bDATE_FORMAT\\s*\\("
      
    - id: my_str_to_date
      name: "STR_TO_DATE()"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bSTR_TO_DATE\\s*\\("
      
    - id: my_date_add
      name: "DATE_ADD()"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bDATE_ADD\\s*\\("
      
    - id: my_date_sub
      name: "DATE_SUB()"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bDATE_SUB\\s*\\("
      
    - id: my_now
      name: "NOW()"
      weight: 2
      detection_method: regex
      pattern: "\\bNOW\\s*\\(\\s*\\)"
      
    - id: my_curdate
      name: "CURDATE()"
      weight: 2
      detection_method: regex
      pattern: "\\bCURDATE\\s*\\(\\s*\\)"
      
    - id: my_on_duplicate
      name: "ON DUPLICATE KEY UPDATE"
      weight: 10
      detection_method: regex
      pattern: "\\bON\\s+DUPLICATE\\s+KEY\\s+UPDATE\\b"
      
    - id: my_insert_ignore
      name: "INSERT IGNORE"
      weight: 10
      detection_method: regex
      pattern: "\\bINSERT\\s+IGNORE\\b"
      
    - id: my_replace_into
      name: "REPLACE INTO"
      weight: 10
      detection_method: regex
      pattern: "\\bREPLACE\\s+INTO\\b"
      
    - id: my_straight_join
      name: "STRAIGHT_JOIN"
      weight: 10
      detection_method: regex
      pattern: "\\bSTRAIGHT_JOIN\\b"
      
    - id: my_use_index
      name: "USE INDEX"
      weight: 10
      detection_method: regex
      pattern: "\\bUSE\\s+INDEX\\s*\\("
      
    - id: my_force_index
      name: "FORCE INDEX"
      weight: 10
      detection_method: regex
      pattern: "\\bFORCE\\s+INDEX\\s*\\("
      
    - id: my_ignore_index
      name: "IGNORE INDEX"
      weight: 10
      detection_method: regex
      pattern: "\\bIGNORE\\s+INDEX\\s*\\("
      
    - id: my_regexp
      name: "REGEXP / RLIKE"
      weight: 5
      detection_method: regex
      pattern: "\\b(REGEXP|RLIKE)\\b"
      
    - id: my_binary
      name: "BINARY (비교)"
      weight: 5
      detection_method: regex
      pattern: "\\bBINARY\\s+\\w+"
      
    - id: my_handler
      name: "DECLARE HANDLER"
      weight: 15
      detection_method: regex
      pattern: "\\bDECLARE\\s+(CONTINUE|EXIT)\\s+HANDLER\\b"
      
    - id: my_prepare
      name: "PREPARE / EXECUTE"
      weight: 15
      detection_method: regex
      pattern: "\\bPREPARE\\s+\\w+\\s+FROM\\b"

  # MariaDB는 MySQL과 동일한 룰 사용
  MDB: *mysql_rules


  # ----------------------------------------------------------
  # 2.3 PostgreSQL (PG)
  # ----------------------------------------------------------
  PG:
    - id: pg_limit
      name: "LIMIT"
      weight: 5
      detection_method: regex
      pattern: "\\bLIMIT\\s+\\d+"
      
    - id: pg_offset
      name: "OFFSET"
      weight: 5
      detection_method: regex
      pattern: "\\bOFFSET\\s+\\d+"
      
    - id: pg_returning
      name: "RETURNING"
      weight: 10
      detection_method: regex
      pattern: "\\bRETURNING\\b"
      
    - id: pg_lateral
      name: "LATERAL"
      weight: 15
      detection_method: regex
      pattern: "\\bLATERAL\\b"
      
    - id: pg_array
      name: "ARRAY[]"
      weight: 15
      detection_method: regex
      pattern: "\\bARRAY\\s*\\["
      
    - id: pg_array_agg
      name: "ARRAY_AGG()"
      weight: 15
      detection_method: regex
      pattern: "\\bARRAY_AGG\\s*\\("
      
    - id: pg_unnest
      name: "UNNEST()"
      weight: 15
      detection_method: regex
      pattern: "\\bUNNEST\\s*\\("
      
    - id: pg_string_agg
      name: "STRING_AGG()"
      weight: 10
      detection_method: regex
      pattern: "\\bSTRING_AGG\\s*\\("
      
    - id: pg_json_extract
      name: "JSON 연산자 (->, ->>)"
      weight: 10
      detection_method: regex
      pattern: "->|->>"
      
    - id: pg_jsonb
      name: "JSONB 연산자"
      weight: 10
      detection_method: regex
      pattern: "@>|<@|\\?|\\|\\?&"
      
    - id: pg_cast_operator
      name: ":: 캐스팅"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\w+::\\w+"
      
    - id: pg_similar_to
      name: "SIMILAR TO"
      weight: 10
      detection_method: regex
      pattern: "\\bSIMILAR\\s+TO\\b"
      
    - id: pg_regex_operator
      name: "~ 정규식"
      weight: 10
      detection_method: regex
      pattern: "~\\s*'|~\\*\\s*'|!~"
      
    - id: pg_ilike
      name: "ILIKE"
      weight: 5
      detection_method: regex
      pattern: "\\bILIKE\\b"
      
    - id: pg_distinct_on
      name: "DISTINCT ON"
      weight: 10
      detection_method: regex
      pattern: "\\bDISTINCT\\s+ON\\s*\\("
      
    - id: pg_for_update_skip
      name: "FOR UPDATE SKIP LOCKED"
      weight: 15
      detection_method: regex
      pattern: "\\bFOR\\s+UPDATE\\s+SKIP\\s+LOCKED\\b"
      
    - id: pg_on_conflict
      name: "ON CONFLICT"
      weight: 10
      detection_method: regex
      pattern: "\\bON\\s+CONFLICT\\b"
      
    - id: pg_with_recursive
      name: "WITH RECURSIVE"
      weight: 20
      detection_method: regex
      pattern: "\\bWITH\\s+RECURSIVE\\b"
      
    - id: pg_exception
      name: "EXCEPTION WHEN"
      weight: 15
      detection_method: regex
      pattern: "\\bEXCEPTION\\s+WHEN\\b"
      
    - id: pg_raise
      name: "RAISE"
      weight: 15
      detection_method: regex
      pattern: "\\bRAISE\\s+(NOTICE|WARNING|EXCEPTION)\\b"
      
    - id: pg_execute
      name: "EXECUTE (동적)"
      weight: 15
      detection_method: regex
      pattern: "\\bEXECUTE\\s+'"


  # ----------------------------------------------------------
  # 2.4 SQL Server (SS)
  # ----------------------------------------------------------
  SS:
    - id: ss_top
      name: "TOP"
      weight: 10
      detection_method: regex
      pattern: "\\bSELECT\\s+TOP\\s+\\d+"
      
    - id: ss_top_percent
      name: "TOP PERCENT"
      weight: 10
      detection_method: regex
      pattern: "\\bTOP\\s+\\d+\\s+PERCENT\\b"
      
    - id: ss_offset_fetch
      name: "OFFSET FETCH"
      weight: 5
      detection_method: regex
      pattern: "\\bOFFSET\\s+\\d+\\s+ROWS\\s+FETCH\\b"
      
    - id: ss_cross_apply
      name: "CROSS APPLY"
      weight: 15
      detection_method: regex
      pattern: "\\bCROSS\\s+APPLY\\b"
      
    - id: ss_outer_apply
      name: "OUTER APPLY"
      weight: 15
      detection_method: regex
      pattern: "\\bOUTER\\s+APPLY\\b"
      
    - id: ss_isnull
      name: "ISNULL()"
      weight: 3
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bISNULL\\s*\\("
      
    - id: ss_iif
      name: "IIF()"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bIIF\\s*\\("
      
    - id: ss_string_agg
      name: "STRING_AGG()"
      weight: 10
      detection_method: regex
      pattern: "\\bSTRING_AGG\\s*\\("
      
    - id: ss_getdate
      name: "GETDATE()"
      weight: 2
      detection_method: regex
      pattern: "\\bGETDATE\\s*\\(\\s*\\)"
      
    - id: ss_dateadd
      name: "DATEADD()"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bDATEADD\\s*\\("
      
    - id: ss_datediff
      name: "DATEDIFF()"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bDATEDIFF\\s*\\("
      
    - id: ss_datepart
      name: "DATEPART()"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bDATEPART\\s*\\("
      
    - id: ss_convert
      name: "CONVERT()"
      weight: 5
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bCONVERT\\s*\\("
      
    - id: ss_nolock
      name: "WITH (NOLOCK)"
      weight: 10
      detection_method: regex
      pattern: "\\bWITH\\s*\\(\\s*NOLOCK\\s*\\)"
      
    - id: ss_rowlock
      name: "WITH (ROWLOCK)"
      weight: 10
      detection_method: regex
      pattern: "\\bWITH\\s*\\(\\s*ROWLOCK\\s*\\)"
      
    - id: ss_tablock
      name: "WITH (TABLOCK)"
      weight: 10
      detection_method: regex
      pattern: "\\bWITH\\s*\\(\\s*TABLOCK\\s*\\)"
      
    - id: ss_option
      name: "OPTION 힌트"
      weight: 10
      detection_method: regex
      pattern: "\\bOPTION\\s*\\("
      
    - id: ss_merge
      name: "MERGE"
      weight: 15
      detection_method: regex
      pattern: "\\bMERGE\\s+\\w+"
      
    - id: ss_output
      name: "OUTPUT 절"
      weight: 10
      detection_method: regex
      pattern: "\\bOUTPUT\\s+(INSERTED|DELETED)\\."
      
    - id: ss_try_catch
      name: "TRY...CATCH"
      weight: 15
      detection_method: regex
      pattern: "\\bBEGIN\\s+TRY\\b"
      
    - id: ss_throw
      name: "THROW"
      weight: 15
      detection_method: regex
      pattern: "\\bTHROW\\b"
      
    - id: ss_raiserror
      name: "RAISERROR"
      weight: 15
      detection_method: regex
      pattern: "\\bRAISERROR\\s*\\("
      
    - id: ss_sp_executesql
      name: "sp_executesql"
      weight: 20
      detection_method: regex
      pattern: "\\bsp_executesql\\b"
      
    - id: ss_exec_string
      name: "EXEC()"
      weight: 15
      detection_method: regex
      pattern: "\\bEXEC(UTE)?\\s*\\(\\s*'"
      
    - id: ss_pivot
      name: "PIVOT"
      weight: 20
      detection_method: regex
      pattern: "\\bPIVOT\\s*\\("
      
    - id: ss_unpivot
      name: "UNPIVOT"
      weight: 20
      detection_method: regex
      pattern: "\\bUNPIVOT\\s*\\("


  # ----------------------------------------------------------
  # 2.5 Altibase (ALT)
  # ----------------------------------------------------------
  ALT:
    - id: alt_limit
      name: "LIMIT"
      weight: 5
      detection_method: regex
      pattern: "\\bLIMIT\\s+\\d+"
      
    - id: alt_rownum
      name: "ROWNUM"
      weight: 15
      detection_method: regex
      pattern: "\\bROWNUM\\b"
      
    - id: alt_nvl
      name: "NVL()"
      weight: 3
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bNVL\\s*\\("
      
    - id: alt_decode
      name: "DECODE()"
      weight: 10
      detection_method: regex
      pattern: "\\bDECODE\\s*\\("
      
    - id: alt_connect_by
      name: "CONNECT BY"
      weight: 25
      detection_method: regex
      pattern: "\\bCONNECT\\s+BY\\b"
      
    - id: alt_hint
      name: "Altibase 힌트"
      weight: 10
      detection_method: regex
      pattern: "/\\*\\+.*\\*/"
      
    - id: alt_upsert
      name: "UPSERT"
      weight: 10
      detection_method: regex
      pattern: "\\bUPSERT\\b"
      
    - id: alt_enqueue
      name: "ENQUEUE"
      weight: 15
      detection_method: regex
      pattern: "\\bENQUEUE\\b"
      
    - id: alt_dequeue
      name: "DEQUEUE"
      weight: 15
      detection_method: regex
      pattern: "\\bDEQUEUE\\b"

  # ----------------------------------------------------------
  # 2.6 IBM DB2 (DB2)
  # ----------------------------------------------------------
  DB2:
    - id: db2_fetch_first
      name: "FETCH FIRST"
      weight: 5
      detection_method: regex
      pattern: "\\bFETCH\\s+FIRST\\s+\\d+\\s+ROWS\\s+ONLY\\b"
      
    - id: db2_with_ur
      name: "WITH UR"
      weight: 10
      detection_method: regex
      pattern: "\\bWITH\\s+UR\\b"
      
    - id: db2_with_cs
      name: "WITH CS"
      weight: 10
      detection_method: regex
      pattern: "\\bWITH\\s+CS\\b"
      
    - id: db2_with_rs
      name: "WITH RS"
      weight: 10
      detection_method: regex
      pattern: "\\bWITH\\s+RS\\b"
      
    - id: db2_with_rr
      name: "WITH RR"
      weight: 10
      detection_method: regex
      pattern: "\\bWITH\\s+RR\\b"
      
    - id: db2_value
      name: "VALUE()"
      weight: 3
      weight_per_occurrence: true
      detection_method: regex
      pattern: "\\bVALUE\\s*\\("
      
    - id: db2_current_date
      name: "CURRENT DATE"
      weight: 2
      detection_method: regex
      pattern: "\\bCURRENT\\s+DATE\\b"
      
    - id: db2_current_timestamp
      name: "CURRENT TIMESTAMP"
      weight: 2
      detection_method: regex
      pattern: "\\bCURRENT\\s+TIMESTAMP\\b"
